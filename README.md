# GPT-3-Encoder-Decoder-PHP

PHP BPE Text Encoder/Decoder for GPT-2 / GPT-3

## About

GPT-2 and GPT-3 use byte pair encoding to turn text into a series of integers to feed into the model.

This is a PHP OOP implementation of OpenAI's original python encoder and decoder which can be
found [here](https://github.com/openai/gpt-2). The main source of inspiration for writing this encoder was the NodeJS
version of this encoder, found [here](https://github.com/latitudegames/GPT-3-Encoder).

You can test the results, by comparing the output generated by this script, with
the [official tokenizer page from OpenAI](https://beta.openai.com/tokenizer).

This specific encoder and decoder is used in the [Aiomatic WordPress plugin](https://1.envato.market/aiomatic), to count
the number of tokens a string will use when sent to OpenAI API. Check more of my work on
my [website](https://coderevolution.ro/).

Encoder uses caching for store characters arrays for encode/decode that can be configured by using
Gpt3EncoderConfiguraion class.

By default, encoder uses php arrays for caching that may be memory intensive, but you can change it to Redis or
Memcached driver

## Usage

The mbstring PHP extension is needed for this tool to work correctly (in case non-ASCII characters are present in the
tokenized text): [details here on how to install mbstring](https://www.php.net/manual/en/mbstring.installation.php)

```php
require './vendor/autoload.php';

$encoder = new \GPT3Encoder\Gpt3Encoder();

$prompt = "Many words map to one token, but some don't: indivisible. Unicode characters like emojis may be split into many tokens containing the underlying bytes: 🤚🏾 Sequences of characters commonly found next to each other may be grouped together: 1234567890";

$token_array = $encoder->encode($prompt);

$original_text = $encoder->decode($token_array);

```

### Or

Pass `true` as second argument to throw exception if decoder can't decode something.
Otherwise, it just skips some character

```php
$original_text = $encoder->decode($token_array,true);
```

## Configuration

```php
require './vendor/autoload.php';
$configuration = (new \GPT3Encoder\Gpt3EncoderConfiguration)
    ->setCacheClass(\GPT3Encoder\Gpt3CacheMemcached::class)
    ->setEncoder(__DIR__.'/encoder.json')
    ->setVocabulary(__DIR__.'/vocabulary.bpe')
    ->setCharacters(__DIR__.'/characters.json')
    ->setMemoryLimitThreshold(10000);   // for memory limit checks

$encoder = new \GPT3Encoder\Gpt3Encoder($configuration);

```